<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Productividad Pro â€” Kanban + Lista</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* ======== ESTILOS BASE ======== */
body {
  font-family: sans-serif;
  margin: 0;
  background: var(--bg, #f4f4f4);
  color: var(--text, #333);
}
header {
  background: var(--header-bg, #1976d2);
  color: white;
  padding: 0.5rem 1rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
header button, header select, header input {
  margin-left: 0.5rem;
}
main {
  padding: 1rem;
}
.kanban {
  display: flex;
  gap: 1rem;
}
.column {
  background: var(--col-bg, #fff);
  border-radius: 6px;
  flex: 1;
  padding: 0.5rem;
}
.card {
  background: white;
  margin: 0.5rem 0;
  padding: 0.5rem;
  border-radius: 4px;
  cursor: grab;
  border-left: 6px solid transparent;
}
.card[data-priority="Alta"] { border-color: #e53935; }
.card[data-priority="Media"] { border-color: #ffb300; }
.card[data-priority="Baja"] { border-color: #43a047; }
.lista table {
  width: 100%;
  border-collapse: collapse;
}
.lista th, .lista td {
  border: 1px solid #ccc;
  padding: 0.4rem;
}
.lista th {
  cursor: grab;
  background: #eee;
}
.dark {
  --bg: #121212;
  --text: #e0e0e0;
  --header-bg: #333;
  --col-bg: #1e1e1e;
}
</style>
</head>
<body>
<header>
  <div>
    <strong>Productividad Pro</strong>
    <button onclick="toggleView()">Cambiar Vista</button>
    <button onclick="newTask()">ï¼‹ Nueva</button>
    <button onclick="inviteUser()">Invitar</button>
    <input id="search" placeholder="Buscar..." oninput="render()">
  </div>
  <div>
    <button onclick="toggleDark()">ðŸŒ™</button>
    <button onclick="exportJSON()">â­³</button>
    <button onclick="importJSON()">â­±</button>
    <button onclick="connectGoogle()">Conectar Google</button>
  </div>
</header>
<main id="app"></main>

<!-- MODAL DE TAREA -->
<div id="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
background:rgba(0,0,0,0.5); align-items:center; justify-content:center;">
  <div style="background:white; padding:1rem; width:300px;">
    <h3 id="modal-title">Tarea</h3>
    <input id="task-title" placeholder="TÃ­tulo"><br>
    <textarea id="task-desc" placeholder="DescripciÃ³n"></textarea><br>
    <label>Prioridad:
      <select id="task-priority">
        <option>Alta</option><option>Media</option><option>Baja</option>
      </select>
    </label><br>
    <label>Vence: <input type="date" id="task-date"></label><br>
    <button onclick="saveTask()">Guardar</button>
    <button onclick="closeModal()">Cerrar</button>
  </div>
</div>

<script>
let tasks = JSON.parse(localStorage.getItem('tasks')||'[]');
let view = localStorage.getItem('view')||'kanban';
let editId = null;

function render(){
  const app = document.getElementById('app');
  const q = document.getElementById('search').value.toLowerCase();
  const filtered = tasks.filter(t=>t.title.toLowerCase().includes(q));
  if(view==='kanban'){
    app.innerHTML = `<div class="kanban">
      ${['Por hacer','En progreso','Hecho'].map(col=>`
        <div class="column" ondragover="event.preventDefault()" ondrop="drop(event,'${col}')">
          <h3>${col}</h3>
          ${filtered.filter(t=>t.status===col).map(t=>`
            <div class="card" draggable="true" ondragstart="drag(event,'${t.id}')" data-priority="${t.priority}">
              ${t.title}
            </div>`).join('')}
        </div>`).join('')}
    </div>`;
  } else {
    app.innerHTML = `<div class="lista">
      <table>
        <thead>
          <tr><th>TÃ­tulo</th><th>Prioridad</th><th>Estado</th><th>Vence</th></tr>
        </thead>
        <tbody>
          ${filtered.map(t=>`
            <tr>
              <td>${t.title}</td>
              <td>
                <select onchange="setPriority('${t.id}',this.value)">
                  <option ${t.priority==='Alta'?'selected':''}>Alta</option>
                  <option ${t.priority==='Media'?'selected':''}>Media</option>
                  <option ${t.priority==='Baja'?'selected':''}>Baja</option>
                </select>
              </td>
              <td>${t.status}</td>
              <td>${t.date||''}</td>
            </tr>`).join('')}
        </tbody>
      </table>
    </div>`;
  }
  localStorage.setItem('tasks', JSON.stringify(tasks));
}

function toggleView(){
  view = view==='kanban'?'lista':'kanban';
  localStorage.setItem('view',view);
  render();
}

function toggleDark(){
  document.body.classList.toggle('dark');
}

function newTask(){
  editId=null;
  document.getElementById('task-title').value='';
  document.getElementById('task-desc').value='';
  document.getElementById('task-priority').value='Media';
  document.getElementById('task-date').value='';
  document.getElementById('modal').style.display='flex';
}

function saveTask(){
  const t = {
    id: editId||Date.now().toString(),
    title: document.getElementById('task-title').value,
    desc: document.getElementById('task-desc').value,
    priority: document.getElementById('task-priority').value,
    date: document.getElementById('task-date').value,
    status: 'Por hacer'
  };
  if(editId){
    const i=tasks.findIndex(x=>x.id===editId);
    tasks[i]=t;
  } else tasks.push(t);
  closeModal();
  render();
}

function closeModal(){
  document.getElementById('modal').style.display='none';
}

function drag(ev,id){
  ev.dataTransfer.setData("text", id);
}
function drop(ev,status){
  const id = ev.dataTransfer.getData("text");
  const t = tasks.find(x=>x.id===id);
  if(t){t.status=status;}
  render();
}

function setPriority(id,val){
  const t = tasks.find(x=>x.id===id);
  if(t){t.priority=val;}
  render();
}

function inviteUser(){
  const email = prompt("Correo del usuario:");
  if(email) location.href=`mailto:${email}?subject=InvitaciÃ³n a Productividad Pro`;
}

function exportJSON(){
  const data = JSON.stringify(tasks);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href=url; a.download='tareas.json';
  a.click();
}

function importJSON(){
  const inp = document.createElement('input');
  inp.type='file';
  inp.onchange=e=>{
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload=()=>{
      tasks=JSON.parse(reader.result);
      render();
    };
    reader.readAsText(file);
  };
  inp.click();
}

function connectGoogle(){
  alert('AquÃ­ conectarÃ­as Google Calendar (configura CLIENT_ID y API_KEY)');
}

render();
</script>
</body>
</html>
